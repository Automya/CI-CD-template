.docker_login: &docker_login
  #- echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin "$CI_REGISTRY"
    - echo "$GCP_SERVICE_KEY_JSON" > gcloud-key.json
    - gcloud auth activate-service-account --key-file=gcloud-key.json
    - gcloud auth configure-docker europe-west1-docker.pkg.dev
.build_image:
  #image: docker:latest
  image: google/cloud-sdk:latest
  stage: build
  tags:
    - build
  before_script:
    - apt-get update -qq && apt-get install -y -qq apt-transport-https ca-certificates curl gnupg docker-ce-cli
    - *docker_login
  script:
    - docker build --network=host -t "$IMAGE_NAME" .
    - docker push "$IMAGE_NAME"