.docker_login: &docker_login
    - echo "$GCP_SERVICE_KEY_AUTOMYA_JSON" > gcloud-key.json
    - gcloud auth activate-service-account --key-file=gcloud-key.json
    - gcloud auth configure-docker europe-west1-docker.pkg.dev
.build_image:
  image: google/cloud-sdk:latest
  stage: build
  tags:
    - build
  before_script:
    - apt-get update -qq
    - apt-get install -y -qq ca-certificates curl gnupg
    - install -m 0755 -d /etc/apt/keyrings
    - curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    - chmod a+r /etc/apt/keyrings/docker.gpg
    - echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
    - apt-get update -qq
    - apt-get install -y -qq docker-ce-cli
    - *docker_login
  script:
    - docker build --network=host --build-arg MAVEN_USERNAME=$MAVEN_USERNAME --build-arg MAVEN_PASSWORD=$MAVEN_PASSWORD -t "$IMAGE_NAME" -f Dockerfile.graalvm .
    - docker push "$IMAGE_NAME"